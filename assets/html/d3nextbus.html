  

<style type="text/css">
	body {
	  font: 10px sans-serif;
	}

	.bar rect {
	  /*fill: forestgreen;*/
	  shape-rendering: crispEdges;
	}

	.bar text {
	  fill: #fff;
	}

	.axis path, .axis line {
	  fill: none;
	  stroke: #000;
	  shape-rendering: crispEdges;
	}

	span.underline{
        border-bottom: 2px solid grey;
		display:block;
		color:#606060;
    }

	.brush .extent {
	    stroke: #000;
	    fill-opacity: .125;
	    shape-rendering: crispEdges;
	}

  

</style>

 <div class="intro">
 	<span class="underline"><h2></h2></span>
</div>

<div class="headQ10">
 	<span style="color:forestgreen"><h2></h2></span>
</div>

<div class="headMed">
 	<span style="color:black"><h2></h2></span>
</div>

<div class="headQ90">
 	<span style="color:firebrick"><h2></h2></span>
</div>


<!-- Adding in numeric input -->
<h3>
  <label for="nMinutes" 
         style="display: inline-block; width: 140px; text-align: right">
         Prediction in Minutes: <span id="nMinutes-value"></span>
  </label>
  <input type="number" min="0" max="100" step="1" value="5" id="nMinutes">
</h3>

<br>


<body>

<!-- loading JS libraries -->
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="/assets/js/posts/jquery.nouislider.min.js"></script>
<link href="/assets/css/posts/jquery.nouislider.css" rel="stylesheet">



<script>

//defining math functions used in js
var Median = function(values) {
    values.sort( function(a,b) {return a - b;} );
    var half = Math.floor(values.length/2);
    if(values.length % 2)
        var ret = values[half];
    else
        var ret = (Number(values[half-1]) + Number(values[half])) / 2.0;
    return parseFloat(ret).toFixed(1);
}

var Quantile = function(values, quantile){
	values.sort( function(a,b) {return a - b;} );
	var q = Math.floor(values.length*quantile);
    var ret = values[q];
    return parseFloat(ret).toFixed(1);
}

var dataset2
    d3.csv("/assets/csv/cleanTrips.csv", function(d) {
    dataset2=d;
})

//controls size of app
var margin = {top: 10, right: 30, bottom: 30, left: 30},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

// A formatter for counts.
var formatCount = d3.format(",.0f");

//intitialize
// via http://www.d3noob.org/2014/04/using-html-inputs-with-d3js.html
d3.select("#nMinutes").on("input", function() {
  d3.select("svg").remove();
  buildhist(dataset2, +this.value);
});



console.log(d3.csv("/assets/csv/cleanTrips.csv", function(d) {
    dataset2=d}));

// buildhist(d3.csv("/assets/csv/cleanTrips.csv", function(d) {
//     dataset2=d}), 10);

// buildhist(d3.csv("/assets/csv/cleanTrips.csv", function(d) {
//     dataset2=d
//     return dataset2})
// , 4)



var buildhist = function(adata, cutoff){

    //taking just estimates where Minutes==cutoff
    var mydata = []
    for(i=0; i<adata.length; i++){
        if (adata[i]["Minutes"]==cutoff) {
            mydata.push(adata[i]["est"])
        }
    }


    //defining dynamic bounds for histogram
    var dmax = Math.max.apply(Math, mydata);
    var dmin = Math.min.apply(Math, mydata);

    //numOfBins = 40;
    if((dmax-dmin)>8) var numOfBins = dmax-dmin
    else var numOfBins = (dmax-dmin)*4; 

    //find statistics for each sentenance
    var busMedian = Median(mydata);
    var busQ90 = Quantile(mydata, 0.9);
    var busQ10 = Quantile(mydata, 0.1);

    var x = d3.scale.linear()
        .domain([dmin, dmax])
        .range([0, width]);

    var data = d3.layout.histogram()
        .bins(x.ticks(numOfBins))(mydata);
    
    var y = d3.scale.linear()
        .domain([0, d3.max(data, function(d) { return d.y; })]) //when cutoff==10, 705
        .range([height, 0]);
    
    var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom").ticks(dmax-dmin);

    var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
    var bar = svg.selectAll(".bar")
        .data(data)
        .enter().append("g")
        .attr("class", "bar")
        .attr("transform", function(d) { return "translate(" + x(d.x) + "," + y(d.y) + ")"; });
        
    bar.append("rect")
        .attr("x", 0) //shifts bars
        .attr("width", (width/data.length)*0.85) //adds spacing between bars. modified to handle x domains that start >0
        .attr("height", function(d) {return height - y(d.y); })
		.style("fill", function(dfff) {
			if (dfff.x<cutoff) {col="forestgreen"}
			else {col="firebrick"}
			return col
		});

    bar.append("text")
        .attr("dy", ".75em")
        .attr("y", 6)
        .attr("x", width/data.length / 2) 
        .attr("text-anchor", "middle")
        .text(function(d) { return formatCount(d.y); });
    
    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);



//printing sentences
$(".intro h2").html("Nextbus prediction of " + cutoff + " minutes really means:");
$(".headQ10 h2").html("&nbsp&nbsp&nbsp&nbsp&nbsp" + busQ10 + " minutes on an early day.");
$(".headMed h2").html("&nbsp&nbsp&nbsp&nbsp&nbsp" +busMedian + " minutes on an average day.");
$(".headQ90 h2").html("&nbsp&nbsp&nbsp&nbsp&nbsp" +busQ90 + " minutes on a late day.");


};

console.log(d3.csv("/assets/csv/cleanTrips.csv", function(d) {
    dataset2=d;
}));

buildhist(d3.csv("/assets/csv/cleanTrips.csv", function(d) {
    dataset2=d;
    return dataset2
}), +this.value);







</script>

</body>